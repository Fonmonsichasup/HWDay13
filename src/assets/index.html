<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Visualization: ‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏±‡∏ö</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans Thai', sans-serif;
      padding: 2rem;
      background-color: #f4f4f4;
      color: #111;
      margin: 0;
    }

    h1, h2 {
      text-align: center;
      color: #7b0000;
      margin-bottom: 1rem;
    }

    .chart-container {
      max-width: 700px;
      margin: 2rem auto;
      padding: 1.5rem;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      border-top: 4px solid #7b0000;
    }

    canvas {
      max-width: 100%;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏Å‡∏£‡∏≤‡∏ü‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ò‡∏µ‡∏° */
    .chart-container h2 {
      color: #333;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

  <h1>üìä Visualization: ‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏±‡∏ö</h1>

  <div class="chart-container">
    <h2>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®</h2>
    <canvas id="genderChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</h2>
    <canvas id="ageChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
    <canvas id="escapeFrequencyChart"></canvas>
  </div>

  <script>
    async function loadData() {
      const res = await fetch('./prisoners_data.json');
      const data = await res.json();

      const genderCount = {};
      const ageGroups = {
        '18-25': 0,
        '26-35': 0,
        '36-45': 0,
        '46-60': 0,
        '61+': 0
      };
      const escapeBuckets = {
        '0': 0,
        '0.1 - 0.5': 0,
        '0.6 - 1.0': 0,
        '1.1 - 2.0': 0
      };

      data.forEach(prisoner => {
        // ‡πÄ‡∏û‡∏®
        genderCount[prisoner.‡πÄ‡∏û‡∏®] = (genderCount[prisoner.‡πÄ‡∏û‡∏®] || 0) + 1;

        // ‡∏≠‡∏≤‡∏¢‡∏∏
        const age = prisoner.‡∏≠‡∏≤‡∏¢‡∏∏;
        if (age <= 25) ageGroups['18-25']++;
        else if (age <= 35) ageGroups['26-35']++;
        else if (age <= 45) ageGroups['36-45']++;
        else if (age <= 60) ageGroups['46-60']++;
        else ageGroups['61+']++;

        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ
        const freq = prisoner["‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"];
        if (freq === 0) escapeBuckets['0']++;
        else if (freq <= 0.5) escapeBuckets['0.1 - 0.5']++;
        else if (freq <= 1.0) escapeBuckets['0.6 - 1.0']++;
        else escapeBuckets['1.1 - 2.0']++;
      });

      // Chart 1: ‡πÄ‡∏û‡∏®
      new Chart(document.getElementById('genderChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(genderCount),
          datasets: [{
            data: Object.values(genderCount),
            backgroundColor: ['#7b0000', '#555555']
          }]
        },
        options: {
          plugins: {
            title: {
              display: true,
              text: '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤',
              color: '#222',
              font: {
                size: 16
              }
            },
            legend: {
              labels: {
                color: '#333'
              }
            }
          }
        }
      });

      // Chart 2: ‡∏≠‡∏≤‡∏¢‡∏∏
      new Chart(document.getElementById('ageChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(ageGroups),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤',
            data: Object.values(ageGroups),
            backgroundColor: '#7b0000'
          }]
        },
        options: {
          plugins: {
            title: {
              display: true,
              text: '‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤',
              color: '#222',
              font: {
                size: 16
              }
            },
            legend: {
              labels: {
                color: '#333'
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: '#333'
              }
            },
            x: {
              ticks: {
                color: '#333'
              }
            }
          }
        }
      });

      // Chart 3: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ
      new Chart(document.getElementById('escapeFrequencyChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(escapeBuckets),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤',
            data: Object.values(escapeBuckets),
            backgroundColor: '#444'
          }]
        },
        options: {
          plugins: {
            title: {
              display: true,
              text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
              color: '#222',
              font: {
                size: 16
              }
            },
            legend: {
              labels: {
                color: '#333'
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: '#333'
              }
            },
            x: {
              ticks: {
                color: '#333'
              }
            }
          }
        }
      });
    }

    loadData();
  </script>

</body>
</html>
